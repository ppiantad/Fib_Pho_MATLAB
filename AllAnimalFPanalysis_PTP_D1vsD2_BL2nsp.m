%% set root directory (where files are located on PC)
root = upper('e:');

% %% D1 Early RM (1st or 2nd session)
% animalNames={
%     'D1-1';...
%     'D1-2';...
% 
%          };
%      
% blockpaths={
%     '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190709-095343'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190710-112923'...
%     
%     };
% 
% behavFiles={
%     'D1-1 07092019.csv'...
%     'D1-2 07102019.csv'...
% 
%     };
% % Sensor D = 12; Sensor C = 34
% whichStreams=[34; ];
% % Old recordings have 2 TTLs, newer ones include "Tick" or "CAM1" which
% % requires > 2. MUST CHECK data.streams.epocs for each mouse to make sure
% % the correct TTL is selected for that particular session (the order is
% % dependent on the # of mice recorded from on that day, etc)
% whichTTL=[2; ];

%% D1 RewardMag baseline day (sometimes day prior to RDT, others a few days prior due to lack of double recording with first group)
% %collect all animal names and blockpaths from user, label blockpaths with
% %animal name
% animalNames={
%     'D1-1';...
%     'D1-1';...
%     'D1-2';...
%     'D1-2';...
%     'D1-4';...
%     'D1-4';...
%     'D1-5';...
%     'D1-5';...
%     'D1-7';...
%     'D1-7';...
%     'D1-8';...
%     'D1-8';...
%     'D1-9';...
%     'D1-9';...
%     'D1-10';...
%     'D1-10';...
%     'D1-11';...
%     'D1-11';...
%     'D1-12';...
%     'D1-12';...
%          };
%      
% blockpaths={
%     '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190718-100659'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190719-095035'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190719-110342'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190722-130703'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-8 & D1-4\D2-8_and_D1-4-190710-153708'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-8 & D1-4\D2-8_and_D1-4-190711-165049'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-5\D1-5-190715-145524'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-5\D1-5-190716-162724'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-7 & D1-8\D1-7_and_D1-8-191028-114510'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-7 & D1-8\D1-7_and_D1-8-191029-111406'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-7 & D1-8\D1-7_and_D1-8-191025-120734'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-7 & D1-8\D1-7_and_D1-8-191028-114510'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-9 & D2-12\D1-9_AND_D2-12-191021-112942'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-9 & D2-12\D1-9_AND_D2-12-191022-115256'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-10 & D1-11\D1-10_and_D1-11-200205-151845'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-10 & D1-11\D1-10_and_D1-11-200206-142838'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-10 & D1-11\D1-10_and_D1-11-200205-151845'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-10 & D1-11\D1-10_and_D1-11-200206-142838'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-12 & D2-13\D1-12_and_D2-13-200205-160815'... #session from 2/6/2020 had weird noise
%     '\MATLAB\TDTbin2mat\Photometry\D1-12 & D2-13\D1-12_and_D2-13-200207-160546'...
%     };
% 
% behavFiles={
%     'D1-1 07182019.csv'...
%     'D1-1 07192019.csv'...
%     'D1-2 07192019.csv'...
%     'D1-2 07222019.csv'...
%     'D1-4 07102019.csv'...
%     'D1-4 07112019.csv'...
%     'D1-5 07152019.csv'...
%     'D1-5 07162019.csv'...
%     'D1-7 10282019.csv'...
%     'D1-7 10292019.csv'...
%     'D1-8 10252019.csv'...
%     'D1-8 10282019.csv'...
%     'D1-9 10212019.csv'...
%     'D1-9 10222019.csv'...
%     'D1-10 02052020.csv'...
%     'D1-10 02062020.csv'...
%     'D1-11 02052020.csv'...
%     'D1-11 02062020.csv'...
%     'D1-12 02052020.csv'...
%     'D1-12 02072020.csv'...
%     };
% 
% session =        [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2];
% %Side of photometry implant, 1 = Left; 2 = Right
% implant_side =   [2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1];
% %Which screen is the large rew side, 1 = Left; 2 = Right
% large_rew_side = [2, 2, 2, 2, 1, 1, 2, 2, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 2, 2];
% % Sensor D = 12; Sensor C = 34
% whichStreams =   [34; 34; 12; 12; 12; 12; 34; 34; 34; 34; 12; 12; 34; 34; 34; 34; 12; 12; 34; 34];
% % Old recordings have 2 TTLs, newer ones include "Tick" or "CAM1" which
% % requires > 2. MUST CHECK data.streams.epocs for each mouse to make sure
% % the correct TTL is selected for that particular session (the order is
% % dependent on the # of mice recorded from on that day, etc)
% whichTTL=         [2; 2; 3; 3; 3; 3; 2; 2; 4; 4; 5; 5; 4; 4; 4; 4; 5; 5; 4; 4];

%%
% D1 RDT data (currently includes 2 sessions per mouse)
% animalNames={
%     'D1-1';...
%     'D1-1';...
%     'D1-2';...
%     'D1-2';...
%     'D1-4';...
%     'D1-4';...
%     'D1-5';...
%     'D1-5';...
%     'D1-7';...
%     'D1-7';...
%     'D1-8';...
%     'D1-8';...
%     'D1-9';...
%     'D1-9';...
%     'D1-10';...
%     'D1-10';...
%     'D1-11';...
%     'D1-11';...
%     'D1-12';...
%     'D1-12';...
%          };
%      
% blockpaths={
%     '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190722-102505'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190726-100550'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190723-131850'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190729-114109'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-8 & D1-4\D2-8_and_D1-4-190712-143938'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-8 & D1-4\D2-8_and_D1-4-190719-143359'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-5\D1-5-190717-160516'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-5\D1-5-190722-160440'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-7 & D1-8\D1-7_and_D1-8-191030-113127'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-7 & D1-8\D1-7_and_D1-8-191106-130514'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-7 & D1-8\D1-7_and_D1-8-191029-111406'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-7 & D1-8\D1-7_and_D1-8-191104-104500'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-9 & D2-12\D1-9_AND_D2-12-191023-130413'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-9 & D2-12\D1-9_AND_D2-12-191030-131024'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-10 & D1-11\D1-10_and_D1-11-200207-143402'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-10 & D1-11\D1-10_and_D1-11-200213-121546'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-10 & D1-11\D1-10_and_D1-11-200207-143402'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-10 & D1-11\D1-10_and_D1-11-200213-121546'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-12 & D2-13\D1-12_and_D2-13-200210-140609'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-12 & D2-13\D1-12_and_D2-13-200217-113748'...
%     };
% 
% behavFiles={
%     'D1-1 07222019.csv'...
%     'D1-1 07262019.csv'...
%     'D1-2 07232019.csv'...
%     'D1-2 07292019.csv'...
%     'D1-4 07122019.csv'...
%     'D1-4 07192019.csv'...
%     'D1-5 07172019.csv'...
%     'D1-5 07222019.csv'...
%     'D1-7 10302019.csv'...
%     'D1-7 11062019.csv'...
%     'D1-8 10292019.csv'...
%     'D1-8 11042019.csv'...
%     'D1-9 10232019.csv'...
%     'D1-9 10302019.csv'...
%     'D1-10 02072020.csv'...
%     'D1-10 02132020.csv'...
%     'D1-11 02072020.csv'...
%     'D1-11 02132020.csv'...
%     'D1-12 02102020.csv'...
%     'D1-12 02172020.csv'...
%     };
% 
% session =         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2];
% %Side of photometry implant, 1 = Left; 2 = Right
% implant_side =    [2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1];
% %Which screen is the large rew side, 1 = Left; 2 = Right
% large_rew_side =  [2, 2, 2, 2, 1, 1, 2, 2, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 2, 2];
% % Sensor D = 12; Sensor C = 34
% whichStreams=     [34; 34; 12; 12; 12; 12; 34; 34; 34; 34; 12; 12; 34; 34; 34; 34; 12; 12; 34; 34];
% % Old recordings have 2 TTLs, newer ones include "Tick" or "CAM1" which
% % requires > 2. MUST CHECK data.streams.epocs for each mouse to make sure
% % the correct TTL is selected for that particular session (the order is
% % dependent on the # of mice recorded from on that day, etc)
% whichTTL=         [2; 2; 3; 2; 3; 3; 2; 2; 4; 4; 5; 5; 4; 4; 4; 4; 5; 5; 4; 4];

%%
% % D2 RewMag day (sometimes day prior to RDT, others a few days prior due to lack of double recording with first group)
% %collect all animal names and blockpaths from user, label blockpaths with
% %animal name
% animalNames={
%     'D2-1';...
%     'D2-1';...
%     'D2-4';... % low signal
%     'D2-4';...
%     'D2-7';... %low-ish signal, beginning of the session looks good for baseline fig?
%     'D2-7';...
%     'D2-8';...
%     'D2-8';...
%     'D2-9';...
%     'D2-9';...
%     'D2-10';...
%     'D2-10';...
%     'D2-12';...
%     'D2-12';...
%     'D2-13';...
%     'D2-13';...
%     'D2-15';...
%     'D2-15';...
%          };
%      
% blockpaths={
%     '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190712-100348'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190715-103018'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190709-115826'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190708-111955'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-6 & D2-7\D2-6_and_D2-7-190715-134801'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-6 & D2-7\D2-6_and_D2-7-190712-135825'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-8 & D1-4\D2-8_and_D1-4-190708-132241'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-8 & D1-4\D2-8_and_D1-4-190709-140550'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-9 & D2-10\D2-9_AND_D2-10-191021-093500'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-9 & D2-10\D2-9_AND_D2-10-191022-094402'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-9 & D2-10\D2-9_AND_D2-10-191028-093029'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-9 & D2-10\D2-9_AND_D2-10-191029-095122'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-9 & D2-12\D1-9_AND_D2-12-191021-112942'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-9 & D2-12\D1-9_AND_D2-12-191022-115256'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-12 & D2-13\D1-12_and_D2-13-200207-160546'...
%     '\MATLAB\TDTbin2mat\Photometry\D1-12 & D2-13\D1-12_and_D2-13-200210-140609'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-14 & D2-15\D2-14_and_D2-15-200205-164513'...
%     '\MATLAB\TDTbin2mat\Photometry\D2-14 & D2-15\D2-14_and_D2-15-200206-160700'...
%     };
% 
% behavFiles={
%     'D2-1 07122019.csv'...
%     'D2-1 07152019.csv'...
%     'D2-4 07092019.csv'...
%     'D2-4 07082019.csv'...
%     'D2-7 07152019.csv'...
%     'D2-7 07122019.csv'...
%     'D2-8 07082019.csv'...
%     'D2-8 07092019.csv'...
%     'D2-9 10212019.csv'...
%     'D2-9 10222019.csv'...
%     'D2-10 10282019.csv'...
%     'D2-10 10292019.csv'...
%     'D2-12 10212019.csv'...
%     'D2-12 10222019.csv'...
%     'D2-13 02072020.csv'...
%     'D2-13 02102020.csv'...
%     'D2-15 02052020.csv'...
%     'D2-15 02062020.csv'...
%     };
% 
% 
% session =         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2];
% %Side of photometry implant, 1 = Left; 2 = Right
% implant_side =    [2, 2, 1, 1, 1, 1, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2];
% %Which screen is the large rew side, 1 = Left; 2 = Right
% large_rew_side =  [1, 1, 1, 1, 2, 2, 1, 1, 2, 2, 1, 1, 2, 2, 1, 1, 2, 2];
% % Sensor D = 12; Sensor C = 34
% whichStreams=     [12; 12; 34; 34; 12; 34; 12; 12; 34; 34; 12; 12; 12; 12; 12; 12; 12; 12];
% % Old recordings have 2 TTLs, newer ones include "Tick" or "CAM1" which
% % requires > 2. MUST CHECK data.streams.epocs for each mouse to make sure
% % the correct TTL is selected for that particular session (the order is
% % dependent on the # of mice recorded from on that day, etc)
% whichTTL=         [3; 3; 2; 2; 3; 2; 3; 3; 4; 4; 5; 5; 5; 5; 5; 5; 5; 5];


%%
%D2 RDT (contains 2 sessions from each mouse)
animalNames={
    'D2-1';...
    'D2-1';...
    'D2-4';... % 
    'D2-4';...
    'D2-7';... %low-ish signal, beginning of the session looks good for baseline fig?
    'D2-7';...
    'D2-8';...
    'D2-8';...
    'D2-9';...
    'D2-9';...
    'D2-10';...
    'D2-10';...
    'D2-12';...
    'D2-12';...
    'D2-13';...
    'D2-13';...
    'D2-15';...
    'D2-15';...
         };
     
blockpaths={
    '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190716-101814'...
    '\MATLAB\TDTbin2mat\Photometry\D1-1 & D2-1\D1-1_and_D2-1-190723-103952'...
    '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190710-112923'...
    '\MATLAB\TDTbin2mat\Photometry\D2-4 & D1-2\D2-4_and_D1-2-190716-124040'...
    '\MATLAB\TDTbin2mat\Photometry\D2-6 & D2-7\D2-6_and_D2-7-190716-151827'...
    '\MATLAB\TDTbin2mat\Photometry\D2-6 & D2-7\D2-6_and_D2-7-190722-142629'...
    '\MATLAB\TDTbin2mat\Photometry\D2-8 & D1-4\D2-8_and_D1-4-190710-153708'...
    '\MATLAB\TDTbin2mat\Photometry\D2-8 & D1-4\D2-8_and_D1-4-190717-150400'...
    '\MATLAB\TDTbin2mat\Photometry\D2-9 & D2-10\D2-9_AND_D2-10-191023-094013'...
    '\MATLAB\TDTbin2mat\Photometry\D2-9 & D2-10\D2-9_AND_D2-10-191030-092822'...
    '\MATLAB\TDTbin2mat\Photometry\D2-9 & D2-10\D2-9_AND_D2-10-191030-092822'...
    '\MATLAB\TDTbin2mat\Photometry\D2-9 & D2-10\D2-9_AND_D2-10-191106-093810'...
    '\MATLAB\TDTbin2mat\Photometry\D1-9 & D2-12\D1-9_AND_D2-12-191023-130413'...
    '\MATLAB\TDTbin2mat\Photometry\D1-9 & D2-12\D1-9_AND_D2-12-191030-131024'...
    '\MATLAB\TDTbin2mat\Photometry\D1-12 & D2-13\D1-12_and_D2-13-200211-132200'...
    '\MATLAB\TDTbin2mat\Photometry\D1-12 & D2-13\D1-12_and_D2-13-200217-113748'...
    '\MATLAB\TDTbin2mat\Photometry\D2-14 & D2-15\D2-14_and_D2-15-200207-170401'...
    '\MATLAB\TDTbin2mat\Photometry\D2-14 & D2-15\D2-14_and_D2-15-200214-123012'...
    };

behavFiles={
    'D2-1 07162019.csv'...
    'D2-1 07232019.csv'...
    'D2-4 07102019.csv'...
    'D2-4 07162019.csv'...
    'D2-7 07162019.csv'...
    'D2-7 07222019.csv'...
    'D2-8 07102019.csv'...
    'D2-8 07172019.csv'...
    'D2-9 10232019.csv'...
    'D2-9 10302019.csv'...
    'D2-10 10302019.csv'...
    'D2-10 11062019.csv'...
    'D2-12 10232019.csv'...
    'D2-12 10302019.csv'...
    'D2-13 02112020.csv'...
    'D2-13 02172020.csv'...
    'D2-15 02072020.csv'...
    'D2-15 02142020.csv'...
    };

session =         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2];
%Side of photometry implant, 1 = Left; 2 = Right
implant_side =    [2, 2, 1, 1, 1, 1, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2];
%Which screen is the large rew side, 1 = Left; 2 = Right
large_rew_side =  [1, 1, 1, 1, 2, 2, 1, 1, 2, 2, 1, 1, 2, 2, 1, 1, 2, 2];
% Sensor D = 12; Sensor C = 34
whichStreams=     [12; 12; 34; 34; 12; 12; 34; 34; 34; 34; 12; 12; 12; 12; 12; 12; 12; 12];
% Old recordings have 2 TTLs, newer ones include "Tick" or "CAM1" which
% requires > 2. MUST CHECK data.streams.epocs for each mouse to make sure
% the correct TTL is selected for that particular session (the order is
% dependent on the # of mice recorded from on that day, etc)
whichTTL=         [3; 3; 2; 2; 3; 3; 2; 2; 4; 4; 5; 5; 5; 5; 5; 5; 5; 5];

%%
numAnimals=numel(animalNames);
dataStruct_names=animalNames;
timeShift=zeros(1,numAnimals);
Channel_405_name=animalNames;
Channel_465_name=animalNames;
TTL_name=animalNames;
numTrials=animalNames;
ID_Table = cell2table(animalNames);

%make table with all animal info

Table=table(animalNames,blockpaths',behavFiles',dataStruct_names,timeShift',Channel_405_name,Channel_465_name,TTL_name,whichStreams,whichTTL,numTrials,session');
Headers={'animalNames','blockpath','behavFiles','dataStruct_names','timeShift','Channel_405_name','Channel_465_name','TTL_name','whichStreams','whichTTL','numTrials','session'};
Table.Properties.VariableNames([1:12])=Headers;

%% Select which session to look at
sessionNum = input('Please enter the # of sessions to analyze per mouse (1, 2, all): \n','s');

if sessionNum == '1'
    idx = Table.session == 1;
    Table = Table(idx,:);
    numAnimals = numel(Table.animalNames(:,1));
    ID_Table = cell2table(Table.animalNames(:,1));
elseif sessionNum == '2'
    idx = Table.session == 2;
    Table = Table(idx,:);
    numAnimals = numel(Table.animalNames(:,1));
    ID_Table = cell2table(Table.animalNames(:,1));
elseif sessionNum == 'all'
end   

%%
impSide = input('Please enter implant side(s) to include (1 = left,  2 = right, all): \n','s');

if impSide == '1'
    idx = Table.implant_side == 1;
    Table = Table(idx,:);
    numAnimals = numel(Table.animalNames(:,1));
    ID_Table = cell2table(Table.animalNames(:,1));
elseif impSide == '2'
    idx = Table.implant_side == 2;
    Table = Table(idx,:);
    numAnimals = numel(Table.animalNames(:,1));
    ID_Table = cell2table(Table.animalNames(:,1));
elseif impSide == 'all'
end

%%
LargeRewSide = input('Please enter Large Rew side to include (1 = left,  2 = right, all): \n','s');

if LargeRewSide == '1'
    idx = Table.large_rew_side == 1;
    Table = Table(idx,:);
    numAnimals = numel(Table.animalNames(:,1));
    ID_Table = cell2table(Table.animalNames(:,1));
elseif LargeRewSide == '2'
    idx = Table.large_rew_side == 2;
    Table = Table(idx,:);
    numAnimals = numel(Table.animalNames(:,1));
    ID_Table = cell2table(Table.animalNames(:,1));
elseif LargeRewSide == 'all'
end

%%

%Choose EPOC
EPOC = input('Please enter the EPOC to filter on (start, Choice, Collect): \n','s');


%% Create table for WinStay/LoseShift data from all mice
%WinStayLoseShift=table(animalNames,
% WinStayLoseShiftTable=table(Wins,Losses,WinStay,LoseShift,WinStayPer,LoseShiftPer);
% Headers2 ={'Wins','Losses','WinStay','LoseShift','WinStayPer','LoseShiftPer'};
% WinStayLoseShiftTable.Properties.VariableNames([1:6])=Headers2;

%%
%run TDTbin2mat on all of these, fill in the table, and store the datastructures in workspace
%for each animal....
rows=0;
for aaa=1:numAnimals
    animalName=Table.animalNames{aaa};
    blockpath=Table.blockpath{aaa};
    whichStreams=Table.whichStreams(aaa);
    whichTTL=Table.whichTTL(aaa);
    behavFiles=Table.behavFiles{aaa};
    [data, meanZAnimal,zerrAnimal,times1,numTrials,Chan405,Chan465,TTLname, Descriptives] =Analysis_BL2initiation_fn_beta(animalName,blockpath,whichStreams,whichTTL,behavFiles,EPOC);
    if meanZAnimal==999
        
        disp(['Animal ' Table.animalNames{aaa} 'has none of the specified trials'])
    else
        ts1=times1;
          rows=rows+1;
        %change NEWNAME=zAnimalAll
        Table.Channel_405_name(aaa)={Chan405};
        Table.Channel_465_name(aaa)={Chan465};
        Table.TTL_name(aaa)={TTLname};
        Table.numofTrials(aaa)={numTrials};
        WinStayLoseShiftTable(aaa,:)=Descriptives;

        %the correction below will adjust data points according to the first
        %inputed dataset.  This needs to be changed in case later sessions are
        %shorter (rather than longer) than the first.  THis error is only a
        %difference of one value - it's just because of the way the data are
        %truncated.
%         if rows>1 
%             if numel(meanZAnimal)> numel(zMultiAnimal(1,:))
%                 disp('time vector has one more element')
%                 newCol=numel(zMultiAnimal(1,:));
%                 meanZAnimal=meanZAnimal(1,1:newCol);
%                 ts1=times1(1,1:newCol);
%                 zerrAnimal=zerrAnimal(1,1:newCol);
%             elseif numel(meanZAnimal)<numel(zMultiAnimal(1,:))
%                 zMultiAnimal=zMultiAnimal(:,1:numel(meanZAnimal));
%                 ZerrMultiAnimal= ZerrMultiAnimal(:,1:numel(meanZAnimal));
%                
%                 disp('time vector has one less element')
%             end
%         end

        zMultiAnimal(rows,:)=meanZAnimal;
%         ZerrMultiAnimal(rows,:)=zerrAnimal;
    end

   
end
%% Concatenate IDs with WS/LS data
WSLS_Table = [ID_Table, WinStayLoseShiftTable];

%%
%make user check table



%collect z scores

%%
[~,cols]=size(zMultiAnimal);

for ii=1:cols %loop through each column of zMultiAnimal to calculate AVG and SD
    zAvg(ii)=mean(zMultiAnimal(:,ii)); %take Avg of the ii-th column (:,ii) of zMultiAnimal, put the Avg in zAvg in the ii-th column
    values=zMultiAnimal(:,ii); %extract the values from the ii-th column (:,ii) of zMultiAnimal
    stdDev(ii)=std(values); % calculate the SD of the column extracted into "values"
end

SEM=stdDev./(sqrt(numAnimals)); %calculate SEM from the SD values by dividing by the sqrt of the total # of sessions (or animals as the case may be)
lo=zAvg-SEM;
hi=zAvg+SEM;


%for TRANGE = -31 41
% ts1forprism = ts1(2137:3967);
% zAvgforprism = zAvg(2137:3967);
% semforprism = SEM(2137:3967);

%for TRANGE = -41 51, gives you -10 to +10 around EPOC
% ts1forprism = ts1(3153:5188);
% zAvgforprism = zAvg(3153:5188);
% semforprism = SEM(3153:5188);

%FOR TRANGE = -51 61, gives you -8 to +8 around EPOC
% zAvgforprism_longer_window = zAvg(4374:6002);
% ts1forprism_longer_window = ts1(4374:6002);
% semforprism_longer_window = SEM(4374:6002);



%%
figure(1)
hold on



% Plot vertical line at epoch onset, time = 0

%for loop for 5 tone retrieval- retrieval is 50 tones though??

% a=0;
% for ii=1:50
%     p1=patch([a a+30 a+30 a], [-5 -5 20 20], [.8 1 1], 'EdgeColor','none');
%     a=a+35;
% end 

% vline = plot([0 0],[min(lo) max(hi)],'--','LineWidth',2)

% y = ylim; % current y-axis limits
vline = plot([0 0],[min(lo) max(hi)]);
vline.Color = 'k';
vline.LineStyle = '--';
vline.LineWidth = 2;

xxx=[ts1, ts1(end:-1:1)];
yyy=[lo, hi(end:-1:1)];
hp= fill(xxx,yyy,[ .8 .8 .8]); hold on;
set(hp,'FaceColor', [ .8 .8 .8],'EdgeColor','none','FaceAlpha',0.8,'EdgeAlpha',0.8);
p3=plot(ts1, zAvg, 'k', 'LineWidth', 2,'DisplayName','z-score'); 
% p_multi=plot(ts1,zMultiAnimal(1,:), 'LineWidth',1); 
% p_multi.Color(4) = .5;
% for bbb=1:height(zMultiAnimal(:,1))
%     p_multi=plot(ts1,zMultiAnimal(:,bbb),'LineWidth',1);
%     p_multi.Color(4) = 0.5;
%     hold on;
% end
[~,cols]=size(zMultiAnimal);


% for nums=1:cols
%     p_multi=plot(ts1,zMultiAnimal(rows,:),'LineWidth',1);
%     p_multi.Color(4) = 0.3; hold on
% end

% Make a legend
legend([p3 hp],{'Block 1','SEM'}, 'AutoUpdate', 'off');

set(gca,'Layer','top')

%%
figure(2);
plot(ts1, zMultiAnimal);
